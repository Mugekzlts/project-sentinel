version: '3.8'

services:
  
  backend-api:
    build: ./app
    container_name: sentinel-backend
    restart: always
    # ports:           <-- DİKKAT: Burayı sildik/yorum satırı yaptık!
    #   - "5000:5000"  <-- Artık dış dünyadan kimse 5000'e erişemez.
    networks:
      - sentinel-net

  nginx-proxy:
    image: nginx:alpine  # Hazır, hafif Nginx imajı
    container_name: sentinel-nginx
    restart: always
    ports:
      - "80:80"          # Dış dünyanın 80. kapısını, Nginx'in 80. kapısına bağla
    volumes:
  
      # Senin yazdığın ayar dosyasını, konteynerin içine "ışınlıyoruz"
      - ./nginx/conf/default.conf:/etc/nginx/conf.d/default.conf:ro
    depends_on:
      - backend-api      # Backend ayağa kalkmadan Nginx çalışmasın
    networks:
      - sentinel-net

  database:
    image: postgres:13-alpine  # Hafif ve güçlü PostgreSQL
    container_name: sentinel-db
    restart: always
    environment:      # Şifreleri ve ayarları buradan veriyoruz
      POSTGRES_USER: admin
      POSTGRES_PASSWORD: secretpassword
      POSTGRES_DB: library_db
    volumes:
      # Kritik Kısım: Konteyner içindeki veriyi, senin bilgisayarına kopyalıyoruz.
      # Konteyner silinse bile ./database/data klasöründeki veriler silinmez.
      - ./database/data:/var/lib/postgresql/data
    networks:
      - sentinel-net  # Backend ile aynı ağda olmalı!

networks:
  sentinel-net:
    driver: bridge
